# Ralph Progress Log
Started: 2026-01-31
Project: SpeakAussie Polish & Ship

## Codebase Patterns
- CSS variables are in src/styles/variables.css (--brand-primary, --brand-bg, etc.)
- Icon components are in src/components/icons/ (DuotoneIcon, CustomIcon)
- Use `npx tsc --noEmit` to typecheck
- Lucide icons are re-exported from src/components/icons/index.ts
- Component CSS files are colocated with their .tsx files
- For radio group patterns, use roving tabindex (focused item has tabIndex=0, others have tabIndex=-1)
- No lint script in package.json - just run typecheck
- Lucide icons only support single color - DuotoneIcon/IconColorScheme uses `primary` color only

---

## 2026-01-31 - TQ-1
- Implemented keyboard navigation for VoiceSelector component
- Files changed: src/components/VoiceSelector.tsx, src/components/VoiceSelector.css
- **Learnings for future iterations:**
  - VoiceSelector uses a list of voice options that should be treated as a radio group
  - Used roving tabindex pattern with useRef array for button references
  - Added focus-visible styles to CSS for keyboard focus indication
  - Arrow keys navigate, Enter/Space selects
---

## 2026-01-31 - TQ-2
- Added prefers-reduced-motion support to Skeleton and StreakReminder components
- Files changed: src/components/Skeleton.css, src/components/StreakReminder.css
- **Learnings for future iterations:**
  - Skeleton.css has a `skeleton-shimmer` keyframe animation that can be disabled with `animation: none`
  - StreakReminder.css has a `slideIn` keyframe animation for toast notifications
  - Pattern for reduced motion: `@media (prefers-reduced-motion: reduce) { .element { animation: none; } }`
  - For skeleton, also reset background to solid color when animation is disabled
---

## 2026-01-31 - TQ-3
- Added ARIA roles for screen reader accessibility
- Files changed: src/components/StreakReminder.tsx, src/components/Skeleton.tsx
- **Learnings for future iterations:**
  - StreakReminder toast/banner: use `role="status" aria-live="polite"` for status announcements
  - Skeleton containers (grid-level): use `role="status" aria-busy="true"` with aria-label for loading state
  - Individual skeleton items: use `aria-hidden="true"` since they're decorative
  - Use `role="status"` (not progressbar) for indeterminate loading states without known completion percentage
---

## 2026-01-31 - TQ-4
- Added focus-visible styles for keyboard accessibility
- Files changed: src/components/VoiceSelector.css, src/components/ErrorBoundary.tsx, src/components/ErrorBoundary.css, src/components/NotFound.tsx, src/components/NotFound.css
- **Learnings for future iterations:**
  - VoiceSelector voice options already had focus-visible from TQ-1, added it to play button
  - ErrorBoundary and NotFound use inline styles, so created separate CSS files for focus-visible
  - Pattern: Add className to element that needs focus-visible, then define `:focus-visible { outline: 2px solid var(--brand-cyan); outline-offset: 2px; }` in CSS
  - Use var(--brand-cyan) for focus outline to match codebase pattern
---

## 2026-01-31 - TQ-5
- Replaced hardcoded colors in ErrorBoundary with CSS variables
- Files changed: src/components/ErrorBoundary.tsx, src/components/ErrorBoundary.css
- **Learnings for future iterations:**
  - Moved all inline styles from the `styles` object to ErrorBoundary.css
  - Color mappings: #111111 → var(--brand-bg), #ffffff → var(--brand-white), #FF65BE → var(--brand-primary), #1a1a1a → var(--brand-card), rgba(255,255,255,0.12) → var(--brand-border), rgba(255,255,255,0.6) → var(--brand-muted), #ff6b6b → var(--brand-error)
  - Removed the `styles` object entirely from the component - all styling now via CSS classes
  - Component uses className attributes for all styled elements
---

## 2026-01-31 - TQ-6
- Replaced hardcoded colors in NotFound with CSS variables
- Files changed: src/components/NotFound.tsx, src/components/NotFound.css
- **Learnings for future iterations:**
  - Same pattern as TQ-5: moved all inline styles from `styles` object to CSS file
  - Color mappings: #111111 → var(--brand-bg), #ffffff → var(--brand-white), #FF65BE → var(--brand-primary), rgba(255,255,255,0.8) → var(--brand-muted)
  - Removed the `styles` object entirely from the component
  - NotFound.css already existed from TQ-4 with focus-visible styles - added all other styles to it
---

## 2026-01-31 - TQ-7
- Extracted magic numbers in UnifiedDashboard to named constants
- Files changed: src/components/UnifiedDashboard.tsx
- **Learnings for future iterations:**
  - Magic numbers were used in progress calculations for StatCard components
  - Added constants: SESSIONS_FOR_FULL_PROGRESS = 50, SECONDS_PER_HOUR = 3600, QUIZZES_FOR_FULL_PROGRESS = 20
  - Constants placed at top of file with explanatory comments above each
  - Pattern: Place constants after imports, before any functions, with comments explaining what each represents
---

## 2026-01-31 - TQ-8
- Removed unused secondary color from IconColorScheme interface
- Files changed: src/components/icons/iconColors.ts
- **Learnings for future iterations:**
  - "DuotoneIcon" was misleading - Lucide icons only support single color via `color` prop
  - Removed `secondary` property from IconColorScheme type and all colorSchemes objects
  - Added comment explaining the design decision (Lucide limitation)
  - The icon system effectively uses single colors per category, not true duotone
---

## 2026-01-31 - TQ-9
- Consolidated IconSize type to single definition
- Files changed: src/components/icons/types.ts (new), src/components/icons/DuotoneIcon.tsx, src/components/icons/CustomIcon.tsx, src/components/icons/index.ts
- **Learnings for future iterations:**
  - Created new types.ts file in icons/ folder for shared types
  - Both IconSize type and sizeMap constant were duplicated - consolidated both
  - Updated index.ts to export IconSize from types.ts and also export sizeMap for external use
  - Pattern: Put shared types/constants in a types.ts file within the feature folder
---

## 2026-01-31 - TQ-10
- Replaced Unicode play/stop symbols with Lucide icons in VoiceSelector
- Files changed: src/components/VoiceSelector.tsx, src/components/VoiceSelector.css, src/components/icons/index.ts
- **Learnings for future iterations:**
  - Lucide `Square` icon works well for stop buttons
  - When replacing text with SVG icons, update CSS from font-size to flexbox styling (flex-shrink: 0)
  - Add `aria-hidden="true"` to decorative icons when the button already has aria-label
  - Import paths: can import Lucide icons directly from 'lucide-react' or from icons/index.ts re-exports
---

## 2026-01-31 - UX-1
- Added audio loading state to VoiceSelector play button
- Files changed: src/components/VoiceSelector.tsx, src/components/VoiceSelector.css, src/components/icons/index.ts
- **Learnings for future iterations:**
  - Use `oncanplaythrough` event to detect when audio is ready to play without buffering
  - Added `Loader2` from Lucide for spinning loading indicator
  - Track loading state separately from playing state (isLoadingAudio, loadingVoiceId)
  - Pattern for loading spinners: use `animation: spin 1s linear infinite` with @keyframes spin
  - Disable button during loading with `disabled` attribute and `cursor: wait` style
  - Allow cancellation of loading by clicking the same button again
---

## 2026-01-31 - UX-2
- Added audio error handling to VoiceSelector
- Files changed: src/components/VoiceSelector.tsx, src/components/VoiceSelector.css
- **Learnings for future iterations:**
  - Added audioErrorVoiceId state to track which voice had an error
  - Error message displayed below play button: "Preview unavailable. You can still select {voice.name}."
  - Error state clears when user tries to play a voice again
  - CSS uses var(--brand-muted) for error text to be visible but not alarming
  - Keep error messages friendly and suggest next steps (can still select the voice)
---

## 2026-01-31 - UX-3
- Audited scenario loading states in ScenarioSelector component
- Files reviewed: src/components/ScenarioSelector.tsx, src/components/Skeleton.tsx, src/data/allScenarios.ts
- **Audit findings:**
  - No loading states needed - scenario data is **statically imported** at build time, not fetched via API
  - `allScenarios` and `allCategories` are synchronous JavaScript module imports
  - `useScenarioProgress` hook reads from localStorage synchronously in useState initializer
  - No flash of empty content occurs since data is available on first render
  - `ScenarioGridSkeleton` exists but correctly isn't used (no async loading to display it for)
  - Only `authLoading` state exists in parent component (for authentication status, not scenarios)
- **Learnings for future iterations:**
  - Scenario data is bundled at build time via static imports, not fetched from an API
  - For static data scenarios, skeleton loaders are not appropriate - they're for async operations
  - The existing Skeleton components (ScenarioGridSkeleton, etc.) are available for future use if API fetching is added
---

## 2026-01-31 - UX-4
- Improved ErrorBoundary focus management for screen reader accessibility
- Files changed: src/components/ErrorBoundary.tsx, src/components/ErrorBoundary.css
- **Learnings for future iterations:**
  - For class components, use `createRef<HTMLDivElement>()` for ref creation
  - Use `componentDidUpdate` to detect state changes and focus the element when error state becomes true
  - Add `role="alert"` and `aria-live="assertive"` for immediate screen reader announcements
  - Use `tabIndex={-1}` to make non-interactive elements focusable programmatically (not via tab)
  - Add `.error-boundary-content:focus { outline: none; }` to hide focus ring for programmatic focus
  - Pattern: Check `prevState` in componentDidUpdate to detect state transitions (e.g., `!prevState.hasError && this.state.hasError`)
---

## 2026-01-31 - UX-5
- Improved NotFound page structure with proper landmarks and document title
- Files changed: src/components/NotFound.tsx
- **Learnings for future iterations:**
  - Use `useEffect` with empty deps to set document.title on component mount
  - Change outer container from `<div>` to `<main>` for proper landmark structure
  - "404" should be visual decoration (use `<p aria-hidden="true">`), not the page heading
  - "Page Not Found" should be the `<h1>` as it's the actual page title
  - Pattern: document.title format is "Page Name - AppName" (e.g., "Page Not Found - SpeakAussie")
---

## 2026-01-31 - UX-6
- Added skip link to UnifiedDashboard for keyboard accessibility
- Files changed: src/components/UnifiedDashboard.tsx, src/components/UnifiedDashboard.css
- **Learnings for future iterations:**
  - Skip link pattern: `<a href="#main-id" className="skip-link">Skip to content</a>` as first child
  - CSS: Position off-screen with `top: -100px`, move into view on `:focus` with `top: 16px`
  - Add `id` attribute to main content element for the skip link to target
  - Use `z-index: 1000` to ensure skip link appears above other elements
  - Remove outline on skip link focus since border provides visual indicator
---

## 2026-01-31 - UX-7
- Fixed heading hierarchy in UnifiedDashboard for proper document outline
- Files changed: src/components/UnifiedDashboard.tsx, src/components/UnifiedDashboard.css
- **Learnings for future iterations:**
  - Changed "Your Progress Dashboard" from `<p>` to `<h2>` as it's the page-level title
  - Changed "Level {level}" from `<h2>` to `<h3>` to maintain proper hierarchy under the h2 page title
  - Updated CSS selectors from `.level-info h2` to `.level-info h3` (both main and responsive styles)
  - Heading hierarchy in UnifiedDashboard is now: h1 (app name) → h2 (page title) → h3 (section content like "Level 5", "Recent Achievements", "Continue Learning")
  - Visual appearance is unchanged because CSS uses class selectors, not element type selectors
---

## 2026-01-31 - UX-8
- Replaced hardcoded colors in VoiceSelector.css with CSS variable references
- Files changed: src/components/VoiceSelector.css
- **Learnings for future iterations:**
  - Used `color-mix(in srgb, var(--brand-color) 10%, transparent)` for rgba opacity variants
  - For gradient darker shade: `color-mix(in srgb, var(--brand-primary) 80%, #000)` instead of hardcoded hex
  - `color-mix()` has good browser support (all modern browsers) and works with CSS variables
  - Pattern: Replace `rgba(R, G, B, 0.X)` with `color-mix(in srgb, var(--brand-color) X0%, transparent)`
  - Replaced 4 hardcoded colors: rgba(17, 232, 246, 0.1), rgba(255, 101, 190, 0.1), #d654a0, rgba(255, 101, 190, 0.4)
---

## 2026-01-31 - UX-9
- Audited icon re-exports bundle impact
- Files changed: src/components/icons/index.ts
- **Audit findings:**
  - Tree-shaking works correctly - Vite/Rollup only includes used icons in final bundle
  - Icon SVG data contributes ~12KB to 771KB bundle (~1.5%) - NOT significant
  - 56 icons are actually used (44 from ./icons, 12 directly from lucide-react)
  - 12 icons were re-exported but never used anywhere - removed them
  - Removed: Award, Coffee, Mail, Meh, Pause, PenTool, PhoneCall, Puzzle, Settings, Spade, User, Video
  - Reorganized exports with category comments for better readability
- **Learnings for future iterations:**
  - Use `npm run build` to see bundle sizes in terminal output
  - Install `rollup-plugin-visualizer` temporarily to analyze bundle contents
  - Lucide icons are tree-shakeable - re-exports don't hurt bundle size
  - Pattern: Organize icon exports by category with comments for maintainability
---

## 2026-01-31 - CV-1
- Fixed emotion leaking into spoken text by adding meta-instructions to prompts
- Files changed: src/hooks/useElevenLabsConversation.ts
- **Implementation details:**
  - Added `EMOTION_HANDLING_INSTRUCTIONS` constant with clear meta-instructions for the AI
  - Created `wrapPromptWithEmotionInstructions()` function to prepend instructions to all scenario prompts
  - Instructions tell AI that emotion words (frustrated, happy, nervous, etc.) are directions for HOW to speak, not things to say
  - Provides concrete wrong/right examples to guide the AI's behavior
  - Applied to all scenario prompts via the startSession function
- **Learnings for future iterations:**
  - ElevenLabs AI can interpret prompt emotion descriptors as things to say out loud
  - Solution is to add explicit meta-instructions that distinguish between tone directions and dialogue
  - The wrapPromptWithEmotionInstructions pattern can be extended for other prompt preprocessing
  - Keep meta-instructions concise but with concrete examples (WRONG/RIGHT format works well)
---

## 2026-01-31 - CV-2
- Added Tom character personality to voices.ts
- Files changed: src/data/voices.ts, src/hooks/useElevenLabsConversation.ts
- **Implementation details:**
  - Created VoicePersonality interface with description, traits, speakingStyle, and exampleExpressions
  - Added personality property to Voice interface
  - Tom's character: friendly Melbourne tradie in early 30s, laid-back, patient, dry humor
  - Created buildCharacterContext() function to format personality into prompt text
  - Character context is prepended to scenario prompts (before emotion handling instructions)
  - Emma has empty personality placeholder (will be defined in CV-3)
- **Learnings for future iterations:**
  - VoicePersonality structure: description (background), traits (bullet points), speakingStyle (how to speak), exampleExpressions (sample phrases)
  - buildCharacterContext() returns empty string if personality.description is empty (graceful handling for undefined personalities)
  - Character context goes BEFORE the scenario prompt but AFTER emotion handling meta-instructions
  - Good personality traits are specific and actionable (not just "friendly" but "friendly and approachable - makes everyone feel welcome")
---

## 2026-01-31 - CV-3
- Added Emma character personality to voices.ts
- Files changed: src/data/voices.ts
- **Implementation details:**
  - Emma: warm, energetic Queensland primary school teacher in late 20s
  - Contrasts with Tom: more expressive, coastal lifestyle, nurturing teacher personality
  - Unique traits: warm/encouraging, energetic/upbeat, genuinely curious, nurturing but not patronizing, quick-witted
  - Speaking style: bright, clear accent with Queensland lilts, more expressive than Tom, uses phrases like "Oh lovely!" and "That's brilliant!"
  - Example expressions: "Sweet as!", "Heaps good!", "Give it a burl", "Too easy!", "Reckon you've got this"
- **Learnings for future iterations:**
  - Character personalities should contrast with each other to feel distinct (Tom: laid-back tradie vs Emma: energetic teacher)
  - Regional variation (Melbourne vs Queensland) adds authenticity to different characters
  - buildCharacterContext() already exists from CV-2, so Emma's personality is automatically injected - no code changes needed beyond defining the personality
  - Good character contrast: occupation (tradie vs teacher), energy level (laid-back vs upbeat), region (Melbourne suburbs vs coastal QLD)
---

## 2026-01-31 - CV-4
- Added difficulty-based prompt modifiers that adjust AI speaking style based on scenario difficulty
- Files changed: src/hooks/useElevenLabsConversation.ts
- **Implementation details:**
  - Created DIFFICULTY_MODIFIERS constant with instructions for beginner, intermediate, and advanced levels
  - Beginner: slow, clear speech, minimal slang, short sentences, patient tone
  - Intermediate: natural pace, common Aussie expressions, balanced authenticity and clarity
  - Advanced: full natural speech, all slang and colloquialisms, realistic immersion
  - Created getDifficultyModifier() function to retrieve the appropriate modifier
  - Difficulty modifier is prepended to the prompt (after emotion instructions, before character context)
- **Learnings for future iterations:**
  - Difficulty type is already exported from src/data/scenarios.ts
  - The prompt construction order is: EMOTION_HANDLING_INSTRUCTIONS + difficultyModifier + characterContext + basePrompt
  - Beginner scenarios need clear guidance on pacing and pausing between sentences
  - Advanced scenarios can include colorful expressions like "not here to fuck spiders" for authentic Aussie immersion
  - The difficulty modifier goes before character context so the character speaks AT the specified difficulty level
---

## 2026-01-31 - CV-5
- Enhanced voice-specific prompt injection with multiple template placeholders
- Files changed: src/hooks/useElevenLabsConversation.ts
- **Implementation details:**
  - Created TemplatePlaceholders interface with 5 available placeholders: name, expression, speakingStyle, traits, description
  - Added buildTemplatePlaceholders() function to construct placeholders from Voice data
  - Replaced injectVoiceName() with injectTemplatePlaceholders() for richer substitution
  - {expression} picks a random phrase from the character's exampleExpressions array
  - Exported TemplatePlaceholders type so scenario authors can reference available placeholders
- **Learnings for future iterations:**
  - Scenario prompts can now use {name}, {expression}, {speakingStyle}, {traits}, {description} placeholders
  - Example usage: "You are {name}, an Australian helping someone. {expression}"
  - Adding new voice characters only requires adding VoicePersonality data - the template system handles injection automatically
  - The buildTemplatePlaceholders function handles graceful fallbacks (empty strings) if personality data is missing
---

## 2026-01-31 - CV-6
- Audited all scenario prompts for consistency across 17 scenario files (~126+ scenarios)
- Files audited: src/data/scenarios.ts, src/data/scenarios-*.ts (all 16 additional files)
- **Audit findings:**
  - No TODO/FIXME/placeholder text found in any prompts
  - All prompts follow consistent structure:
    - Single-character: "You are {name}, [role description]..."
    - Multi-character (10 scenarios): "You are playing multiple [description]..." with {name} referenced in the body
  - All scenarios have complete fields (no empty culturalTip, prompt, firstMessage, or icon values)
  - Cultural tips are appropriate and don't conflict with AI behavior instructions
  - First messages use natural Australian greetings ("G'day!", "Hey!")
  - Template placeholder {name} used consistently (170 occurrences across all files)
  - Other placeholders ({expression}, {speakingStyle}, {traits}, {description}) available but not needed in base prompts since character context is injected separately via buildCharacterContext()
- **No code changes required** - prompts are already consistent and high quality
- **Learnings for future iterations:**
  - Scenario prompts support 5 template placeholders: {name}, {expression}, {speakingStyle}, {traits}, {description}
  - Multi-character scenarios start with "You are playing multiple..." and list numbered personas
  - The "You are {name}" pattern is intentional and provides character context
  - Cultural tips give guidance to users, not AI behavior instructions (those are in emotion handling and difficulty modifiers)
---
